shopt -s expand_aliases
set -u
alias set='trace "[set-not-enable] $(caller)"'

trap_err(){
    echo 1>&2 $FUNCNAME
    echo 1>&2 "$(caller)"
    test -f /tmp/err && { cat 1>&2 /tmp/err; } || true
    exit 1
}


indicator0 () 
{ 
    local res_last=${1:-$?};
    local num="${1:-$res_last}";
    if [ $num -eq 0 ]; then
        trace '[V]';
    else
        trace '[X]';
    fi;
    return $num
}


cat0(){
local file=$1
 test -f $file && (
 trace $file
 print_line0
 cat 1>&2 $file;
 )
}

ensure0() 
{ 
    local args=($@);
    local cmd="${args[@]}";
    print_line0
    trace0 "[ENSURE] $cmd";
    eval "$cmd" || { exit 1; }
}

print_line0(){
trace0 '-----------------------'
}

trace0(){
 echo 1>&2 $@ 
}

commander0() 
{ 
    local args=($@);
    local cmd="${args[@]}";
    print_line0
    trace0 "[CMD] $cmd";
    eval "$cmd" || { exit 1; }
}

export -f trace0
export -f commander0
export -f print_line0
export -f ensure0
export -f cat0
export -f indicator0
export -f trap_err
trap trap_err ERR
